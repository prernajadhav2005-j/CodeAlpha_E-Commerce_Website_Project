{% extends 'store/base.html' %}
{% load static %}

{% block content %}

<div class="row">

  <!-- ================= CATEGORY SIDEBAR ================= -->
  <div class="col-md-3">
    <h5 class="mb-3">Categories</h5>

    {% for cat in categories %}
      <a href="/?category={{ cat.id }}"
         class="text-decoration-none text-dark">

        <div class="d-flex align-items-center mb-2 p-2 border rounded">

          {% if cat.icon and cat.icon.name %}
            <img src="{{ cat.icon.url }}"
                 width="40" height="40"
                 class="me-2 rounded">
          {% else %}
            <img src="{% static 'categories/default-category.png' %}"
                 width="40" height="40"
                 class="me-2 rounded">
          {% endif %}

          <span class="fw-semibold">{{ cat.name }}</span>
        </div>
      </a>
    {% endfor %}
  </div>

  <!-- ================= PRODUCTS SECTION ================= -->
  <div class="col-md-9">

    <!-- ðŸ” SEARCH BAR -->
    <form method="get" class="mb-3">
      {% if request.GET.category %}
        <input type="hidden" name="category" value="{{ request.GET.category }}">
      {% endif %}

      <input
        type="text"
        name="search"
        value="{{ request.GET.search }}"
        class="form-control"
        placeholder="Search products..."
      >
    </form>

    <div class="row">

      {% for product in products %}
        <div class="col-md-4">
          <div class="card mb-4 h-100 shadow-sm">

            <!-- âœ… IMAGE â†’ PRODUCT DETAIL PAGE -->
            <a href="{% url 'product_detail' product.id %}">
              {% if product.image and product.image.name %}
                <img src="{{ product.image.url }}"
                     class="card-img-top"
                     style="height:200px; object-fit:cover;">
              {% else %}
                <img src="{% static 'store/default-product.png' %}"
                     class="card-img-top"
                     style="height:200px; object-fit:cover;">
              {% endif %}
            </a>

            <div class="card-body d-flex flex-column">

              <!-- âœ… NAME â†’ PRODUCT DETAIL PAGE -->
              <h5 class="card-title">
                <a href="{% url 'product_detail' product.id %}"
                   class="text-decoration-none text-dark">
                  {{ product.name }}
                </a>
              </h5>

              <p class="text-muted small">
                {{ product.description|truncatewords:12 }}
              </p>

              <strong class="mb-2">â‚¹{{ product.price }}</strong>

              <!-- ADD TO CART -->
              <a href="{% url 'add_to_cart' product.id %}"
                 class="btn btn-primary mt-auto w-100">
                Add to Cart
              </a>

            </div>
          </div>
        </div>

      {% empty %}
        <p class="text-muted">No products found.</p>
      {% endfor %}

    </div>
  </div>
</div>

{% endblock %}
